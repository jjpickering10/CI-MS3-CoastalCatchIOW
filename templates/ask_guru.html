{% extends "base.html" %}
{% block content %}



<h4>Most liked questions</h4>

{% for likedquestion in liked_questions %}
<p>{{ likedquestion.category_name }}</p>
<p>{{ likedquestion.question_title }}</p>
<p>{{ likedquestion.question_description }}</p>
<p>{{ likedquestion.like_count }}</p>
{% endfor %}

<div class="carousel">
  <!-- <a class="carousel-item" href="#one!"><img src="https://lorempixel.com/250/250/nature/1"></a>
    <a class="carousel-item" href="#two!"><img src="https://lorempixel.com/250/250/nature/2"></a>
    <a class="carousel-item" href="#three!"><img src="https://lorempixel.com/250/250/nature/3"></a>
    <a class="carousel-item" href="#four!"><img src="https://lorempixel.com/250/250/nature/4"></a>
    <a class="carousel-item" href="#five!"><img src="https://lorempixel.com/250/250/nature/5"></a> -->
  {% for user in users %}
  <div class="carousel-item" class="row">
    <div class="col s12 m7">
      <div class="card">
        <div class="card-image">
          {% if user.user_image %}
          <img src="{{ url_for('file', filename=user.user_image) }}">
          {% else %}
          <img src="{{ url_for('static', filename='img/blank_profile_image.png') }}">
          {% endif %}
          <span class="card-title">{{ user.username }}</span>
        </div>
        <div class="card-content">
          <p>I am a very simple card. I am good at containing small bits of information.
            I am convenient because I require little markup to use effectively.</p>
        </div>
        <div class="card-action">
          <a href="#">This is a link</a>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<p class="guru-background">Isle of Wight</p>

<div class="ask-guru-container">

  <div class="ask-guru-info-container">
    <div class="guru-text-content">
      <h3>
        Ask a <span>guru</span>
      </h3>
      <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Blanditiis sapiente quo voluptates saepe labore iste
        culpa expedita, ad quam vitae omnis. Incidunt accusantium earum pariatur doloremque ad totam illo repellendus
        quidem hic? Dolore officia fugiat doloribus ut temporibus soluta neque architecto animi dicta commodi nihil ipsum,
        cupiditate facilis natus debitis?</p>
    </div>
  </div>

  <div class="question-container">
    {% if session.user %}
    <div class="ask-question">
      <h3>Ask <span>question</span></h3>
      <form class="" method="POST" action="{{ url_for('ask_guru') }}">
        
        <div class="row">
          <div class="input-field">
            <select id="category_id" name="category_id" class="validate" required>
              <!-- <option value="" disabled selected>Choose Category</option> -->
              {% for category in categories %}
              <option value="{{ category._id }}">{{ category.category_name }}</option>
              {% endfor %}

            </select>
            <label for="category_id">Question Category</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field">
            <input id="question_title" name="question_title" type="text" class="validate" required>
            <label for="question_title">Title</label>
          </div>
        </div>
        <div class="row">
          
            <div class="input-field">
              <textarea id="question_description" name="question_description" class="materialize-textarea validate"
                required></textarea>
              <label for="question_description">Description</label>
            </div>
          
        </div>
        <div class="row">
         
            <button type="submit" class="btn-large">
              Submit Question
            </button>
         
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

<div class="row question-category-section">
  <div class="col s12 pagination center-align">
    {% for category in categories %}
    <button class="btn-large category-buttons">{{ category.category_name }}</button>
    {% endfor %}
    <p id="no-posts" class="questions-hide">No Posts Yet</p>
  </div>
  
</div>

{% for question in questions %}

<div class="row questions-list questions-hide" data-questions="{{ question.category_name }}">
  {% set count = [] %}
  {% set class = [] %}
  <div class="col s12 m6">
    <div class="card blue-grey darken-1">
      <div class="card-content white-text">
        <span class="card-title">{{ question.category_name }}</span>
        <span class="card-title">{{ question.question_title }}</span>



        {% for like in likes %}
        {% if question._id == like.question_id %}
        {% set __ = count.append(1) %}

        {% endif %}

        {% endfor %}
        <p>{{ count|length }}</p>
        {% if session.user %}
        {% for like in liked_user %}
        {% if like.question_id == question._id %}
        {% set __ = class.append(1) %}
        {% endif %}
        {% endfor %}
        {% endif %}
        {% if class|length > 0 %}
        <a href="{{ url_for('like_question', question_id=question._id) }}"><i class="fas fa-thumbs-up"></i></a>
        {% else %}
        <a href="{{ url_for('like_question', question_id=question._id) }}"><i class="far fa-thumbs-up"></i></a>
        {% endif %}


        <p>
          {{ question.question_description }}
        </p>
      </div>
      {% for reply in replies %}
      {% if reply.question_id == question._id %}
      <p>{{ reply.reply }}</p>
      {% if session.user|lower == question.created_by|lower or session.admin|lower == "yes" %}
      <a href="{{ url_for('delete_reply', reply_id=reply._id) }}" class="btn-small">Delete</a>
      <a href="{{ url_for('edit_reply', reply_id=reply._id) }}" class="btn-small">Edit</a>
      {% endif %}
      {% endif %}
      {% endfor %}
      <div class="card-content white-text">
        <p>{{ question.created_by }}</p>
        {% if session.user|lower == question.created_by|lower or session.admin|lower == "yes" %}
        <a href="{{ url_for('delete_question', question_id=question._id) }}" class="btn-small">Delete</a>
        <a href="{{ url_for('edit_question', question_id=question._id) }}" class="btn-small">Edit</a>
        {% endif %}
      </div>

    </div>
  </div>
  {% if session.guru|lower == "yes" %}

  <div class="row">
    <form class="col s12 m6" method="POST" action="{{ url_for('add_reply', question_id=question._id) }}">
      <div class="row">
        <div class="input-field col s12 m6">
          <textarea id="reply" name="reply" class="materialize-textarea validate"></textarea>
          <label for="reply">Textarea</label>
        </div>
        <button type="submit" class="btn-small">
          Add Reply
        </button>
      </div>
    </form>
  </div>

  {% endif %}
</div>

{% endfor %}



{% endblock %}
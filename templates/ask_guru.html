{% extends "base.html" %}
{% block content %}

  <div class="row register-form-container">
    <div class="col s12 m8 offset-m2">
      <div class="card-panel register-card">
          <h3>
            Ask a guru
          </h3>
      </div>
    </div>
  </div>

  <div class="carousel">
    <!-- <a class="carousel-item" href="#one!"><img src="https://lorempixel.com/250/250/nature/1"></a>
    <a class="carousel-item" href="#two!"><img src="https://lorempixel.com/250/250/nature/2"></a>
    <a class="carousel-item" href="#three!"><img src="https://lorempixel.com/250/250/nature/3"></a>
    <a class="carousel-item" href="#four!"><img src="https://lorempixel.com/250/250/nature/4"></a>
    <a class="carousel-item" href="#five!"><img src="https://lorempixel.com/250/250/nature/5"></a> -->
    {% for user in users %}
    <div class="carousel-item" class="row">
      <div class="col s12 m7">
        <div class="card">
          <div class="card-image">
            {% if user.user_image %}
            <img src="{{ url_for('file', filename=user.user_image) }}">
          {% else %}
          <img src="{{ url_for('static', filename='img/blank_profile_image.png') }}">
          {% endif %}
            <span class="card-title">{{ user.username }}</span>
          </div>
          <div class="card-content">
            <p>I am a very simple card. I am good at containing small bits of information.
            I am convenient because I require little markup to use effectively.</p>
          </div>
          <div class="card-action">
            <a href="#">This is a link</a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  

  <br>
  <br>

  {% if session.user %}
  <div class="row">
    <form class="col s12" method="POST" action="{{ url_for('ask_guru') }}">
      <h4 class="center-align">Ask question</h4>
        <div class="row">
          <div class="input-field col s6 offset-m3">
            <input id="question_title" name="question_title" type="text" class="validate" required>
            <label for="question_title">Title</label>
          </div>
        </div>
        <div class="row">
            <div class="row">
              <div class="input-field col s6 offset-m3">
                <textarea id="question_description" name="question_description" class="materialize-textarea validate" required></textarea>
                <label for="question_description">Description</label>
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col s12 center-align">
            <button type="submit" class="btn-large">
              Submit Question
            </button>
          </div>
        </div>
    </form>
  </div>
  {% endif %}

  {% for question in questions %}
  
  <div class="row">
    {% set count = [] %}
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">{{ question.question_title }}
            
           
            {% for like in likes %}
              {% if question._id == like.question_id %}
                {% set __ = count.append(1) %}
                
              {% endif %}
              
            {% endfor %}
            <p>{{ count|length }}</p>
            
            <a href="{{ url_for('like_question', question_id=question._id) }}"><i class="far fa-thumbs-up"></i></a>
            
          </span>
          <p>
            {{ question.question_description }}
          </p>
        </div>
        {% for reply in replies %}
        {% if reply.question_id == question._id %}
        <p>{{ reply.reply }}</p>
          {% if session.user|lower == question.created_by|lower or session.admin|lower == "yes" %}
            <a href="{{ url_for('delete_reply', reply_id=reply._id) }}" class="btn-small">Delete</a>
            <a href="{{ url_for('edit_reply', reply_id=reply._id) }}" class="btn-small">Edit</a>
          {% endif %}
        {% endif %}
        {% endfor %}
        <div class="card-content white-text">
          <p>{{ question.created_by }}</p>
          {% if session.user|lower == question.created_by|lower or session.admin|lower == "yes" %}
          <a href="{{ url_for('delete_question', question_id=question._id) }}" class="btn-small">Delete</a>
          <a href="{{ url_for('edit_question', question_id=question._id) }}" class="btn-small">Edit</a>
          {% endif %}
        </div>
        
      </div>
    </div>
  </div>
  {% if session.guru|lower == "yes" %}

  <div class="row">
    <form class="col s12 m6" method="POST" action="{{ url_for('add_reply', question_id=question._id) }}">
      <div class="row">
        <div class="input-field col s12 m6">
          <textarea id="reply" name="reply" class="materialize-textarea validate"></textarea>
          <label for="reply">Textarea</label>
        </div>
        <button type="submit" class="btn-small">
          Add Reply
        </button>
      </div>
    </form>
  </div>

  {% endif %}
  {% endfor %}

  

{% endblock %}
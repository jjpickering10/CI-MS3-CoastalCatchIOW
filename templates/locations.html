{% extends "base.html" %}
{% block content %}

      {% if session.admin|lower == "yes" %}
      <div class="row">
        <div class="col s12 m12 center-align">
          <a href="{{ url_for('view_locations') }}" class="btn-large">Edit Locations</a>
        </div>
      </div>
      {% endif %}

      <main>
      {% for location in locations %}
      <div class="card locations-card">
        <div class="card-image">
          {% if location.location_image %}
          <img src="{{ url_for('file', filename=location.location_image) }}">
          {% else %}
          <img src="{{ url_for('static', filename='img/blank_profile_image.png') }}">
          {% endif %}
        </div>
        <div class="card-content locations-info">
          <span class="card-title">{{ location.location_name }}</span>
          <p>{{ location.location_description }}</p>
          
          {% set rating_score = [] %}
            {% for rating in ratings %}
            {% if rating.location_id == location._id %}
              {% set __ = rating_score.append(rating.rating) %}
            {% endif %}
            {% endfor %}
            {% if rating_score|length > 0 %}
              <p>Current Rating: {{ ((rating_score|sum)/rating_score|length)|round(1, 'ceil') }}</p>
              <p>Total Ratings: {{ rating_score|length }}</p>
            {% else %}
              <p>No Ratings Yet</p>
            {% endif %}
          

        </div>
        <div class="card-links">
          <a class="locations-links" href="{{ url_for('locations', location_id=location._id) }}">This is a link</a>
        </div>
      </div>
      {% endfor %}
    </main>

{% endblock %}

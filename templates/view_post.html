{% extends "base.html" %}
{% block content %}


  {% set favourite = [] %}
  <div class="row">
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">{{ post.review_title }}</span>
          {% if session.user %}
            {% for fav in fav_user %}
                {% if fav.post_id == post._id %}
                  {% set __ = favourite.append(1) %}
                {% endif %}
            {% endfor %}
            {% endif %}
            {% if favourite|length > 0 %}
            <a href="{{ url_for('favourite_post', post_id=post._id) }}"><i class="fas fa-heart"></i></a>
            {% else %}
            <a href="{{ url_for('favourite_post', post_id=post._id) }}"><i class="far fa-heart"></i></a>
            {% endif %}
          <p>
            {{ post.review_description }}
          </p>
        </div>
        
        {% for comment in comments %}
        {% if comment.post_id == post._id %}
        <p>{{ comment.comments }}</p>
        <p>{{ comment.date_created }}</p>
          {% if session.user|lower == comment.created_by|lower or session.admin|lower == "yes" %}
            <a href="{{ url_for('delete_comment', comment_id=comment._id) }}" class="btn-small">Delete</a>
            <a href="{{ url_for('edit_comment', comment_id=comment._id) }}" class="btn-small">Edit</a>
          {% endif %}
        {% endif %}
        {% endfor %}
       
        
        <div class="card-action">
          <p>Date: {{ post.date_created }}</p>
          <p>Posted by: {{ post.created_by }}</p>
          {% if session.user|lower == post.created_by|lower or session.admin|lower == "yes" %}
          <a href="{{ url_for('delete_post', post_id=post._id) }}" class="btn-small">Delete</a>
          <a href="{{ url_for('edit_post', post_id=post._id) }}" class="btn-small">Edit</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if session.user %}

  <div class="row">
    <form class="col s12 m6" method="POST" action="{{ url_for('add_comment', post_id=post._id) }}">
      <div class="row">
        <div class="input-field col s12 m6">
          <textarea id="comments" name="comments" class="materialize-textarea validate"></textarea>
          <label for="comments">Textarea</label>
        </div>
        <button type="submit" class="btn-small">
          Add Comment
        </button>
      </div>
    </form>
  </div>

  {% endif %}
  

{% endblock %}
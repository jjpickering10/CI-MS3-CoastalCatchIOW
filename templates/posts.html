{% extends "base.html" %}
{% block content %}



  <div class="row posts-info">
    <div class="col s6">
      {% if location.location_image %}
          <img class="posts-image" src="{{ url_for('file', filename=location.location_image) }}" alt="{{ location.location_name }}">
          {% else %}
          <img class="posts-image" src="{{ url_for('static', filename='img/blank_profile_image.png') }}" alt="{{ location.location_name }}">
          {% endif %}
    </div>
    <div class="col s6">
      <h3 class="posts-heading">
        {{ location.location_name }}
      </h3>
      <p>{{ location.location_description }}</p>
      {% if session.user %}
      
      <form class="col s12" method="POST" action="{{ url_for('rate_location', location_id=location._id) }}">
        <h4 class="center-align">Rate Location</h4>
        <div class="row">
          <div class="input-field col s6 offset-m3">
            <select id="rating_score" name="rating_score" class="validate" required>
              <!-- <option value="" disabled selected>Choose Category</option> -->
              
              <option value="1">1 Star</option>
              <option value="2">2 Star</option>
              <option value="3">3 Star</option>
              <option value="4">4 Star</option>
              <option value="5">5 Star</option>
              
  
            </select>
            <label for="rating_score">Rating</label>
          </div>
        </div>
          
          
          <div class="row">
            <div class="col s12 center-align">
              <button type="submit" class="btn-large">
                Submit Rating
              </button>
            </div>
          </div>
      </form>
      {% if rating != None %}
      <p>You rated this: {{ rating.rating }} stars</p>
      {% else %}
      <p>You haven't rated this yet</p>
      {% endif %}
      
      {% endif %}
    </div>
  </div>

  <br>
  <br>

  {% if session.user %}
  <div class="row">
    <form class="col s12" method="POST" action="{{ url_for('locations', location_id=location._id) }}">
      <h4 class="center-align">{{ location.location_name }}</h4>
        <div class="row">
          <div class="input-field col s6 offset-m3">
            <input id="review_title" name="review_title" type="text" class="validate" required>
            <label for="review_title">Title</label>
          </div>
        </div>
        <div class="row">
            <div class="row">
              <div class="input-field col s6 offset-m3">
                <textarea id="review_description" name="review_description" class="materialize-textarea validate" required></textarea>
                <label for="review_description">Description</label>
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col s12 center-align">
            <button type="submit" class="btn-large">
              Submit Post
            </button>
          </div>
        </div>
    </form>
  </div>
  {% endif %}

  {% for review in reviews %}
  <div class="row">
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">{{ review.review_title }}</span>
          <p>
            {{ review.review_description }}
          </p>
        </div>
        
        {% for comment in comments %}
        {% if comment.post_id == review._id %}
        <p>{{ comment.comments }}</p>
        <p>{{ comment.date_created }}</p>
          {% if session.user|lower == comment.created_by|lower or session.admin|lower == "yes" %}
            <a href="{{ url_for('delete_comment', comment_id=comment._id) }}" class="btn-small">Delete</a>
            <a href="{{ url_for('edit_comment', comment_id=comment._id) }}" class="btn-small">Edit</a>
          {% endif %}
        {% endif %}
        {% endfor %}
       
        
        <div class="card-action">
          <p>Date: {{ review.date_created }}</p>
          <p>Posted by: {{ review.created_by }}</p>
          {% if session.user|lower == review.created_by|lower or session.admin|lower == "yes" %}
          <a href="{{ url_for('delete_post', post_id=review._id) }}" class="btn-small">Delete</a>
          <a href="{{ url_for('edit_post', post_id=review._id) }}" class="btn-small">Edit</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if session.user %}

  <div class="row">
    <form class="col s12 m6" method="POST" action="{{ url_for('add_comment', post_id=review._id) }}">
      <div class="row">
        <div class="input-field col s12 m6">
          <textarea id="comments" name="comments" class="materialize-textarea validate"></textarea>
          <label for="comments">Textarea</label>
        </div>
        <button type="submit" class="btn-small">
          Add Comment
        </button>
      </div>
    </form>
  </div>

  {% endif %}
  {% endfor %}
{% endblock %}
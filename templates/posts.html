{% extends "base.html" %}
{% block content %}

  <div class="row register-form-container">
    <div class="col s12 m8 offset-m2">
      <div class="card-panel register-card">
          <h3>
            {{ location.location_name }}'s Posts
          </h3>
      </div>
    </div>
  </div>

  <br>
  <br>

  {% if session.user %}
  <div class="row">
    <form class="col s12" method="POST" action="{{ url_for('locations', location_id=location._id) }}">
      <h4 class="center-align">{{ location.location_name }}</h4>
        <div class="row">
          <div class="input-field col s6 offset-m3">
            <input id="review_title" name="review_title" type="text" class="validate" required>
            <label for="review_title">Title</label>
          </div>
        </div>
        <div class="row">
            <div class="row">
              <div class="input-field col s6 offset-m3">
                <textarea id="review_description" name="review_description" class="materialize-textarea validate" required></textarea>
                <label for="review_description">Description</label>
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col s12 center-align">
            <button type="submit" class="btn-large">
              Submit Post
            </button>
          </div>
        </div>
    </form>
  </div>
  {% endif %}

  {% for review in reviews %}
  <div class="row">
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">{{ review.review_title }}</span>
          <p>
            {{ review.review_description }}
          </p>
        </div>
        
        {% for comment in comments %}
        {% if comment.post_id == review._id %}
        <p>{{ comment.comments }}</p>
          {% if session.user|lower == comment.created_by|lower or session.admin|lower == "yes" %}
            <a href="{{ url_for('delete_comment', comment_id=comment._id) }}" class="btn-small">Delete</a>
            <a href="{{ url_for('edit_comment', comment_id=comment._id) }}" class="btn-small">Edit</a>
          {% endif %}
        {% endif %}
        {% endfor %}
       
        
        <div class="card-action">
          <p>Posted by: {{ review.created_by }}</p>
          {% if session.user|lower == review.created_by|lower or session.admin|lower == "yes" %}
          <a href="{{ url_for('delete_post', post_id=review._id) }}" class="btn-small">Delete</a>
          <a href="{{ url_for('edit_post', post_id=review._id) }}" class="btn-small">Edit</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if session.user %}

  <div class="row">
    <form class="col s12 m6" method="POST" action="{{ url_for('add_comment', post_id=review._id) }}">
      <div class="row">
        <div class="input-field col s12 m6">
          <textarea id="comments" name="comments" class="materialize-textarea validate"></textarea>
          <label for="comments">Textarea</label>
        </div>
        <button type="submit" class="btn-small">
          Add Comment
        </button>
      </div>
    </form>
  </div>

  {% endif %}
  {% endfor %}
{% endblock %}